# 패스파인더 키트 Flask 대시보드 사용법 가이드

## 🎯 개요
이 가이드는 패스파인더 키트의 웹 기반 제어 대시보드 사용법을 안내합니다. Flask 웹 프레임워크를 기반으로 한 직관적인 인터페이스를 통해 로봇을 원격으로 제어할 수 있습니다.

## 🌐 대시보드 기능

### 핵심 기능
- 🎮 **실시간 로봇 제어**: 방향키 및 조이스틱 제어
- 📹 **라이브 카메라 스트리밍**: 실시간 영상 확인
- 📊 **센서 데이터 모니터링**: 초음파 센서 거리 측정값
- 📸 **이미지 캡처**: 사진 촬영 및 저장
- ⚡ **비상 정지**: 즉시 모든 동작 중단
- 📈 **실시간 상태 표시**: 배터리, 연결 상태 등

## 🚀 대시보드 실행

### 1단계: 웹 서버 시작
```bash
# 패스파인더 키트 디렉토리로 이동
cd ~/Pathfinder-Kit/7.WebUploader

# 가상환경 활성화 (설정한 경우)
source ~/pathfinder-env/bin/activate

# 웹 서버 실행
python3 web_controller.py
```

### 2단계: 서버 시작 확인
```
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.100:5000
Press CTRL+C to quit
```

### 3단계: 웹 브라우저 접속
```
http://pathfinder-kit.local:5000
또는
http://192.168.1.100:5000
```

## 🎮 대시보드 인터페이스

### 메인 화면 구성
```
┌─────────────────────────────────────────────────────────┐
│                패스파인더 키트 제어판                      │
├─────────────────┬───────────────────┬───────────────────┤
│   카메라 영상    │    제어 패널       │   상태 정보        │
│                │                  │                  │
│  [실시간 스트림] │   [방향 버튼]      │  [센서 데이터]     │
│                │   [조이스틱]       │  [배터리 상태]     │
│                │   [속도 조절]      │  [연결 상태]       │
│                │   [비상 정지]      │                  │
└─────────────────┴───────────────────┴───────────────────┘
```

## 🕹️ 제어 방법

### 방향 제어 버튼
```
        ⬆️
        전진
    ⬅️      ➡️
   좌회전    우회전
        ⬇️
        후진
```

#### 버튼 기능
- **⬆️ 전진**: 로봇이 앞으로 이동
- **⬇️ 후진**: 로봇이 뒤로 이동  
- **⬅️ 좌회전**: 로봇이 제자리에서 왼쪽으로 회전
- **➡️ 우회전**: 로봇이 제자리에서 오른쪽으로 회전
- **⏹️ 정지**: 모든 모터 정지

### 가상 조이스틱
```
     ↖️  ⬆️  ↗️
      \  |  /
   ⬅️ ── ⭕ ── ➡️
      /  |  \
     ↙️  ⬇️  ↘️
```

#### 조이스틱 사용법
1. **중앙 원을 클릭하고 드래그**
2. **방향에 따라 로봇이 이동**
3. **거리에 따라 속도 조절**
4. **놓으면 자동으로 정지**

### 속도 조절
```
속도: [━━━━━━━━━━] 50%
      0%        100%
```
- **슬라이더로 최대 속도 설정**
- **실시간 속도 변경 가능**
- **안전을 위해 초기값은 50%**

## 📹 카메라 기능

### 라이브 스트리밍
- **실시간 영상**: 160도 광각 카메라 영상
- **해상도**: 640x480 (기본값)
- **프레임레이트**: 15-30fps (네트워크 상태에 따라)
- **지연시간**: 0.5-2초 (Wi-Fi 환경에 따라)

### 이미지 캡처
```bash
📸 [사진 촬영] 버튼 클릭
↓
이미지 저장: /static/uploads/capture_YYYYMMDD_HHMMSS.jpg
↓
다운로드 링크 제공
```

### 카메라 설정
- **밝기 조절**: 자동/수동 설정
- **화질 조절**: 저화질/고화질 선택
- **회전**: 0°, 90°, 180°, 270° 회전

## 📊 센서 모니터링

### 초음파 센서 (HC-SR04)
```
거리: 25.3 cm
상태: 🟢 정상
범위: 2-400 cm
업데이트: 실시간 (0.5초 간격)
```

### 상태 표시
- **🟢 정상**: 2-400cm 범위 내 측정
- **🟡 주의**: 10cm 이하 (장애물 근접)
- **🔴 경고**: 5cm 이하 (충돌 위험)
- **⚫ 오류**: 센서 연결 문제

## ⚡ 비상 정지 기능

### 비상 정지 버튼
```
🚨 [비상 정지] 🚨
```

#### 동작 방식
1. **즉시 모든 모터 정지**
2. **모든 제어 명령 무시**
3. **안전 모드 활성화**
4. **수동으로 해제 필요**

#### 해제 방법
```
🔄 [안전 모드 해제] 버튼 클릭
```

## 📱 모바일 지원

### 반응형 디자인
- **스마트폰**: 세로 모드 최적화
- **태블릿**: 가로 모드 지원
- **터치 제어**: 터치 친화적 버튼 크기

### 모바일 전용 기능
- **터치 조이스틱**: 멀티터치 지원
- **제스처 제어**: 스와이프로 방향 제어
- **진동 피드백**: 버튼 클릭 시 진동

## 🔧 고급 설정

### 네트워크 설정
```python
# web_controller.py 설정 변경
app.run(
    host='0.0.0.0',      # 모든 IP에서 접속 허용
    port=5000,           # 포트 번호
    debug=False,         # 디버그 모드 (개발 시에만 True)
    threaded=True        # 멀티스레딩 지원
)
```

### 보안 설정
```python
# 기본 인증 추가 (선택사항)
from flask_httpauth import HTTPBasicAuth

auth = HTTPBasicAuth()

@auth.verify_password
def verify_password(username, password):
    return username == 'admin' and password == 'pathfinder'
```

### 성능 최적화
```python
# 카메라 해상도 조정
CAMERA_RESOLUTION = (320, 240)  # 낮은 해상도로 성능 향상
CAMERA_FRAMERATE = 15           # 프레임레이트 조정
```

## 🔍 문제 해결

### 일반적인 문제들

#### 웹 페이지가 로드되지 않는 경우
```bash
# 1. 서버 실행 상태 확인
ps aux | grep python

# 2. 포트 사용 확인
sudo netstat -tlnp | grep :5000

# 3. 방화벽 확인
sudo ufw status
```

#### 카메라 영상이 나오지 않는 경우
```bash
# 1. 카메라 모듈 확인
vcgencmd get_camera

# 2. 카메라 권한 확인
groups | grep video

# 3. 카메라 프로세스 확인
ps aux | grep libcamera
```

#### 로봇이 제어되지 않는 경우
```bash
# 1. GPIO 권한 확인
groups | grep gpio

# 2. 하드웨어 연결 확인
gpio readall

# 3. 모터 드라이버 전원 확인
# L298N LED 상태 확인
```

#### 느린 응답 속도
```bash
# 1. 네트워크 지연 확인
ping pathfinder-kit.local

# 2. CPU 사용률 확인
htop

# 3. 메모리 사용량 확인
free -h
```

### 성능 최적화 팁

#### 네트워크 최적화
- **유선 연결 사용** (가능한 경우)
- **5GHz Wi-Fi 사용** (2.4GHz보다 빠름)
- **라우터와 가까운 거리** 유지

#### 시스템 최적화
```bash
# 불필요한 서비스 중지
sudo systemctl disable bluetooth
sudo systemctl disable cups

# GPU 메모리 할당 조정
sudo raspi-config
# Advanced Options → Memory Split → 128
```

## 📋 사용 체크리스트

### 시작 전 확인사항
- [ ] Raspberry Pi Zero 2 W 전원 연결
- [ ] Wi-Fi 네트워크 연결 확인
- [ ] 카메라 모듈 연결 상태
- [ ] 모터 및 센서 연결 확인
- [ ] 배터리 충전 상태

### 웹 서버 실행 확인
- [ ] Flask 서버 정상 시작
- [ ] 웹 브라우저 접속 성공
- [ ] 카메라 영상 스트리밍 확인
- [ ] 제어 버튼 응답 확인
- [ ] 센서 데이터 업데이트 확인

### 안전 확인사항
- [ ] 비상 정지 버튼 동작 확인
- [ ] 장애물 감지 기능 확인
- [ ] 배터리 잔량 모니터링
- [ ] 과열 방지 시스템 확인

## 🎉 사용 완료!

축하합니다! 패스파인더 키트 Flask 대시보드 사용법을 마스터했습니다.
이제 다음 단계인 [개별 컴포넌트 테스트](../1.ComponentTest/)로 넘어가세요.

## 📞 추가 도움말

### 유용한 단축키
- **Spacebar**: 비상 정지
- **WASD**: 키보드로 방향 제어
- **R**: 페이지 새로고침
- **F11**: 전체화면 모드

### 개발자 도구
```bash
# 로그 실시간 확인
tail -f ~/Pathfinder-Kit/7.WebUploader/app.log

# 네트워크 트래픽 모니터링
sudo iftop

# 시스템 리소스 모니터링
htop
```

### 커스터마이징
- **CSS 수정**: `/static/style.css`
- **JavaScript 수정**: `/static/script.js`
- **HTML 템플릿**: `/templates/index.html`
- **Flask 라우트**: `web_controller.py`

---

**💡 팁: 모바일에서 사용할 때는 화면을 가로로 회전하면 더 편리합니다!**
