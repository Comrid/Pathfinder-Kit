# 🚧 패스파인더 장애물 회피 시스템

초음파 센서를 이용한 자율 주행 장애물 회피 시스템입니다. 로봇이 스스로 장애물을 감지하고 회피하며 목적지까지 이동할 수 있습니다.

## 📋 목차
- [시스템 개요](#시스템-개요)
- [하드웨어 구성](#하드웨어-구성)
- [소프트웨어 기능](#소프트웨어-기능)
- [설치 및 실행](#설치-및-실행)
- [사용법](#사용법)
- [장애물 회피 알고리즘](#장애물-회피-알고리즘)
- [설정 변경](#설정-변경)
- [문제 해결](#문제-해결)

## 🎯 시스템 개요

### 주요 기능
- **자율 주행**: 사용자 개입 없이 스스로 이동
- **장애물 감지**: 초음파 센서로 전방 장애물 실시간 감지
- **지능형 회피**: 장애물 발견 시 자동으로 회피 경로 선택
- **실시간 카메라 피드**: 로봇의 시점에서 실시간 영상 스트리밍
- **실시간 모니터링**: 웹 인터페이스를 통한 상태 확인
- **통계 수집**: 주행 데이터 및 회피 패턴 분석

### 학습 목표
- 센서 기반 자율 주행 원리 이해
- 실시간 의사결정 알고리즘 학습
- 로보틱스 제어 시스템 구현
- 웹 기반 모니터링 시스템 개발
- 컴퓨터 비전과 로보틱스 통합

## 🔧 하드웨어 구성

### 필수 구성품
- **Raspberry Pi Zero 2 W**: 메인 컨트롤러
- **160도 광각 카메라**: 실시간 영상 스트리밍
- **HC-SR04 초음파 센서**: 거리 측정
- **L298N 모터 드라이버**: 모터 제어
- **기어 DC 모터 2개**: 좌우 바퀴 구동
- **점퍼 와이어**: 연결용

### GPIO 핀 배치
```
모터 드라이버 (L298N):
- IN1: GPIO23 (오른쪽 모터 방향 1)
- IN2: GPIO24 (오른쪽 모터 방향 2)
- IN3: GPIO22 (왼쪽 모터 방향 1)
- IN4: GPIO27 (왼쪽 모터 방향 2)
- ENA: GPIO12 (오른쪽 모터 PWM)
- ENB: GPIO13 (왼쪽 모터 PWM)

초음파 센서 (HC-SR04):
- TRIG: GPIO5 (송신)
- ECHO: GPIO6 (수신)
```

## 💻 소프트웨어 기능

### 핵심 기능
1. **거리 측정**
   - 초음파 센서로 전방 거리 실시간 측정
   - 노이즈 제거를 위한 다중 샘플링
   - 측정 오류 감지 및 처리

2. **실시간 카메라 피드**
   - 로봇 시점의 실시간 영상 스트리밍
   - 웹 브라우저에서 실시간 확인 가능
   - 거리 정보 및 상태 오버레이 표시
   - PiCamera2 및 USB 카메라 지원

3. **장애물 회피 로직**
   - 3단계 거리 임계값 설정
   - 상황별 행동 패턴 정의
   - 안전한 경로 탐색

4. **모터 제어**
   - PWM 기반 속도 제어
   - 정밀한 방향 제어
   - 부드러운 가속/감속

5. **웹 인터페이스**
   - 실시간 상태 모니터링
   - 실시간 카메라 피드 표시
   - 주행 통계 시각화
   - 원격 제어 및 비상 정지

### 거리 임계값
- **위험 거리**: 10cm (즉시 후진)
- **장애물 감지**: 20cm (회피 시작)
- **안전 거리**: 30cm (정상 주행)

## 🚀 설치 및 실행

### 1. 의존성 설치
```bash
cd 4.ObstacleAvoidance
pip install -r requirements.txt
```

### 2. 시스템 실행
```bash
python app.py
```

### 3. 웹 인터페이스 접속
```
브라우저에서 http://라즈베리파이IP:5000 접속
```

## 📱 사용법

### 웹 인터페이스 구성

#### 1. 제어 패널
- **🚀 시작**: 장애물 회피 시스템 시작
- **⏹️ 정지**: 시스템 정지
- **🚨 비상 정지**: 즉시 모든 동작 중단

#### 2. 상태 모니터링
- **현재 거리**: 전방 장애물까지의 거리 (cm)
- **로봇 상태**: 현재 행동 (정지/전진/회전/후진)
- **시스템 모드**: 하드웨어/시뮬레이션 모드

#### 3. 주행 통계
- **장애물 감지**: 총 감지된 장애물 수
- **좌회전/우회전**: 회피 방향 통계
- **후진 횟수**: 위험 상황 대응 횟수
- **주행 거리**: 대략적인 이동 거리
- **실행 시간**: 총 주행 시간

#### 4. 실시간 카메라 피드
- **라이브 영상**: 로봇의 시점에서 실시간 영상 확인
- **정보 오버레이**: 거리, 상태, 시간 정보 표시
- **연결 상태**: 카메라 연결 상태 실시간 확인
- **시뮬레이션 모드**: 카메라 없을 시 가상 화면 표시

#### 5. 실시간 차트
- 거리 측정값의 시간별 변화
- 장애물 감지선 (20cm) 표시
- 안전선 (30cm) 표시

#### 6. 로그 시스템
- 실시간 행동 로그
- 색상별 이벤트 분류
- 타임스탬프 포함

## 🧠 장애물 회피 알고리즘

### 기본 동작 흐름
```
1. 거리 측정 (100ms 주기)
2. 상황 판단
3. 행동 결정
4. 모터 제어
5. 상태 업데이트
```

### 상황별 행동 패턴

#### 🟢 안전 구간 (30cm 이상)
- **행동**: 정상 속도로 전진
- **속도**: 80%
- **상태**: "전진"

#### 🟡 주의 구간 (20-30cm)
- **행동**: 저속으로 전진
- **속도**: 50%
- **상태**: "전진" (저속)

#### 🟠 장애물 감지 (10-20cm)
- **행동**: 정지 → 회전 → 재탐색
- **회전**: 좌우 랜덤 선택
- **시간**: 1초간 회전
- **상태**: "좌회전" 또는 "우회전"

#### 🔴 위험 구간 (10cm 미만)
- **행동**: 즉시 후진 → 회전 → 재탐색
- **후진**: 0.5초간 후진
- **회전**: 1초간 회전
- **상태**: "후진" → "회전"

### 의사결정 트리
```
거리 측정
    ├─ 측정 실패 → 정지
    ├─ < 10cm → 후진 + 회전
    ├─ 10-20cm → 회전
    ├─ 20-30cm → 저속 전진
    └─ > 30cm → 정상 전진
```

## ⚙️ 설정 변경

### 거리 임계값 조정
```python
# app.py 파일에서 수정
OBSTACLE_DISTANCE = 20  # 장애물 감지 거리
SAFE_DISTANCE = 30      # 안전 거리
CRITICAL_DISTANCE = 10  # 위험 거리
```

### 속도 설정
```python
SPEED_NORMAL = 80       # 일반 주행 속도
SPEED_SLOW = 50         # 저속 주행
SPEED_TURN = 70         # 회전 속도
```

### 행동 시간 설정
```python
FORWARD_TIME = 2.0      # 전진 시간
TURN_TIME = 1.0         # 회전 시간
BACKUP_TIME = 0.5       # 후진 시간
```

## 🔍 문제 해결

### 일반적인 문제

#### 1. 거리 측정이 불안정한 경우
**원인**: 초음파 센서 연결 불량 또는 노이즈
**해결책**:
- 센서 연결 상태 확인
- 전원 공급 안정성 점검
- 측정 주기 조정

#### 2. 로봇이 같은 곳에서 계속 회전하는 경우
**원인**: 좁은 공간에 갇힘
**해결책**:
- 회전 시간 증가
- 후진 거리 증가
- 회전 방향 알고리즘 개선

#### 3. 모터가 작동하지 않는 경우
**원인**: GPIO 핀 설정 오류 또는 전원 부족
**해결책**:
- GPIO 핀 배치 확인
- 모터 드라이버 전원 점검
- PWM 설정 확인

#### 4. 웹 인터페이스 연결 안됨
**원인**: 네트워크 설정 또는 방화벽
**해결책**:
- IP 주소 확인
- 포트 5000 개방 확인
- WiFi 연결 상태 점검

### 디버깅 모드

#### 시뮬레이션 모드 활용
- GPIO 없이도 테스트 가능
- 가상 장애물 생성
- 알고리즘 검증 용이

#### 로그 분석
- 실시간 로그로 동작 추적
- 문제 발생 시점 파악
- 패턴 분석을 통한 개선점 도출

## 📈 성능 최적화

### 측정 정확도 향상
- 다중 샘플링 (기본 3회)
- 이동 평균 필터링
- 아웃라이어 제거

### 반응 속도 개선
- 측정 주기 최적화 (100ms)
- 비동기 처리
- 우선순위 기반 스케줄링

### 배터리 수명 연장
- 적응형 속도 제어
- 대기 모드 구현
- 효율적인 경로 탐색

## 🎓 학습 확장

### 고급 기능 구현
1. **다중 센서 융합**: 여러 초음파 센서 활용
2. **경로 기억**: 지나온 경로 저장 및 활용
3. **목표 지향 탐색**: 특정 목적지로의 이동
4. **장애물 지도 작성**: SLAM 기법 적용

### 알고리즘 개선
1. **강화학습**: Q-Learning 적용
2. **퍼지 로직**: 불확실성 처리
3. **유전 알고리즘**: 최적 경로 탐색
4. **신경망**: 패턴 인식 및 예측

## 📚 참고 자료

### 관련 문서
- [0.Guide/0_Hardware_Setup.md](../0.Guide/0_Hardware_Setup.md): 하드웨어 조립 가이드
- [3.IntegratedFlask/](../3.IntegratedFlask/): 통합 제어 시스템
- [2.ComponentFlask/2.SonicFlask/](../2.ComponentFlask/2.SonicFlask/): 초음파 센서 기본 사용법

### 추천 학습 자료
- 로보틱스 기초 이론
- 센서 융합 기법
- 실시간 시스템 설계
- 웹 기반 IoT 제어

---

**🎯 학습 목표 달성도 체크리스트**
- [ ] 초음파 센서 원리 이해
- [ ] 장애물 회피 알고리즘 구현
- [ ] 실시간 모니터링 시스템 구축
- [ ] 자율 주행 로봇 완성
- [ ] 성능 최적화 및 확장 기능 구현

**다음 단계**: [5.LineTracing](../5.LineTracing/) - 라인 트레이싱 시스템으로 발전! 